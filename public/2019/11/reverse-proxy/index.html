<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Reverse Proxy | 反向代理是什么？ | LoveIt Theme</title><meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="robots" content="noodp" />
<meta name="Description" content="Jack&#39;s Blog">
<link rel="prev" href="https://blog.spencerwoo.com/2019/11/tiny-tiny-rss/" />
<link rel="next" href="https://blog.spencerwoo.com/2019/11/weibo-to-twitter/" />
<link rel="canonical" href="https://blog.spencerwoo.com/2019/11/reverse-proxy/" />
<link rel='shortcut icon' type='image/x-icon' href='/favicon.ico' />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Reverse Proxy | 反向代理是什么？"/>
<meta name="twitter:description" content="Tiny Tiny RSS | 最速部署私有 RSS 服务器 这篇文章里面，我们提到了「利用 Nginx 作为反向代理」来为 Tiny Tiny RSS 服务加上 SSL 支持。事实上，我经常都能在各个和 Nginx、Apache Server 等相关文档里面看到「反向代理」这个术语。今天我们就来看看，到底什么是反向代理？「反向代理」的工作原理，以及我们都可以用「反向代理」来干什么？
Proxy：什么是代理？ 首先，反向代理（Reverse Proxy）是一种代理（Proxy）服务。为了搞清楚「反向代理」，我们首先来说一说「代理 - Proxy」。
相信阅读这篇文章的同学一定对 Proxy 这个名词不陌生，Mainland China 互联网现状让大部分同学的计算机网络知识突飞猛进😂。简单来说，Proxy 服务器的主要功能就是在客户端 Client 和服务端 Server 之间搭建一个桥梁，从客户端访问服务端的网络流量、以及从服务端返回客户端的网络流量都会经由这一 Proxy 服务器的转发。1
为了方便表述，我们就叫我们的 Proxy 服务器：咕咕，一只鸽子。🐦
正向代理和反向代理 Forward Proxy：正向代理 飞鸽传书嘛，信鸽主要功能就是通风报信，我们这里的咕咕也不例外。咕咕在正常情况下是我们自己（客户端）的，也就意味着：咕咕会在 Client 前面等待送信。当 Client 准备发送一个请求的时候，咕咕会拿着这个请求，在公共互联网上面，将请求准确送达至对应的 Server。同理，Server 返回 response 给 Client，response 也会先被咕咕拿到，之后再转交给 Client。
上面就是「正向代理」的基本工作流程，咕咕就是我们这个例子里面的正向代理服务器，负责转发和接受从 Client 发出或收到的网络请求。我们用正向代理（Forward Proxy），除了大家人尽皆知的目的以外😂，还可以：
 有效屏蔽广告、追踪脚本等有害请求。咕咕可以选择性的将 Server 发来的内容进行屏蔽，也就是：咕咕知道这次发来的是个广告，不给我们看也无妨大碍，那为了让我们浏览体验更加纯净，咕咕就非常体贴的丢掉了这一广告。爱了 ❤️ 2 有效的隐藏我们的身份。因为咕咕在你没有用到它的时候，可以并行的为其他同学传递请求。这时候，Server 是无从知道请求的真正来源的，只知道是由咕咕转手的，从而保证我们身份匿名性。  Reverse Proxy：反向代理 那么反向代理是怎样工作的呢？在反向代理中，我们的咕咕现在由服务器 Server 养活（部署），也就是说，咕咕在服务器端通风报信。每个从 Client 经由互联网发过来的请求会先到达咕咕这里，咕咕再将每个请求分发给相应的服务器。反之亦然。这就是「反向代理」的基本工作原理，我们在这个例子里面的「咕咕」，就是我们的反向代理服务器。（Reverse Proxy Server）"/>
<script type="application/ld+json">
    {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "headline": "Reverse Proxy | 反向代理是什么？",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https:\/\/blog.spencerwoo.com\/2019\/11\/reverse-proxy\/"
    },
    
        "image": {
            "@type": "ImageObject",
            "url": "https:\/\/blog.spencerwoo.com\/cover.png",
            "width":  800 ,
            "height":  600 
        },
    
    "genre": "posts",
    
        "keywords": "Tech, Server",
    
    "wordcount":  409 ,
    "url": "https:\/\/blog.spencerwoo.com\/2019\/11\/reverse-proxy\/",
    
        "datePublished": "2019-11-22T21:14:00\x2b08:00",
    
    
        "dateModified": "2019-11-22T21:14:00\x2b08:00",
    
    
        "license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.",
    
    
        "publisher": {
            "@type": "Organization",
            "name": "Jack Wang",
            "logo": {
            "@type": "ImageObject",
            "url": "https:\/\/blog.spencerwoo.com\/logo.png",
            "width":  127 ,
            "height":  40 
            }
        },
    
    
    "description": ""
    }
    </script>
<link rel="stylesheet" href="/css/style.min.css">
<link rel="stylesheet" href="/css/lib/fontawesome-free/all.min.min.css">

<link rel="stylesheet" href="/css/lib/animate/animate.min.min.css">

    </head>
    <body>
        <script>
            window.isDark = (window.localStorage && window.localStorage.getItem('theme')) === 'dark';
            window.isDark && document.body.classList.add('dark-theme');
        </script>
        <div class="wrapper">
            <nav class="navbar">
    <div class="navbar-container">
        <div class="navbar-header">
            <a href="https://blog.spencerwoo.com">LoveIt Theme</a>
        </div>
        <div class="navbar-menu">
            
            
                <a class="menu-item" href="https://blog.spencerwoo.com/posts/" title="">Posts</a>
            
                <a class="menu-item" href="https://blog.spencerwoo.com/tags/" title="">Tags</a>
            
                <a class="menu-item" href="https://blog.spencerwoo.com/categories/" title="">Categories</a>
            
                <a class="menu-item" href="https://blog.spencerwoo.com/about/" title="">About</a>
            
                <a class="menu-item" href="https://hugo-loveit-zh.netlify.com" title=""><i class="fas fa-language fa-fw"></i></a>
            
            <a href="javascript:void(0);" class="theme-switch"><i class="fas fa-adjust fa-rotate-180 fa-fw"></i></a>
        </div>
    </div>
</nav>
<nav class="navbar-mobile">
     <div class="navbar-container">
        <div class="navbar-header">
            <div><a href="javascript:void(0);" class="theme-switch"><i class="fas fa-adjust fa-rotate-180 fa-fw"></i></a>
                <span></span>
                <a href="https://blog.spencerwoo.com">LoveIt Theme</a></div>
            <div class="menu-toggle" id="menu-toggle">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="navbar-menu" id="mobile-menu">
            
            
                <a class="menu-item" href="https://blog.spencerwoo.com/posts/" title="">Posts</a>
            
                <a class="menu-item" href="https://blog.spencerwoo.com/tags/" title="">Tags</a>
            
                <a class="menu-item" href="https://blog.spencerwoo.com/categories/" title="">Categories</a>
            
                <a class="menu-item" href="https://blog.spencerwoo.com/about/" title="">About</a>
            
                <a class="menu-item" href="https://hugo-loveit-zh.netlify.com" title=""><i class="fas fa-language fa-fw"></i></a>
            
        </div>
    </div>
</nav>
<main class="main">
                <div class="container">
                    
    
    
    

    <article class="post-warp">
        <h1 class="post-title animated flipInX">Reverse Proxy | 反向代理是什么？</h1>

        <div class="post-meta">
            <div class="post-meta-main">
                <a class="author" href="https://blog.spencerwoo.com" rel="author"><i class="fas fa-user-circle fa-fw"></i>Jack Wang&nbsp;</a>
                <span class="post-category">
                        included in
                        <i class="far fa-folder fa-fw"></i><a href="https://blog.spencerwoo.com/categories/%E6%8A%80%E6%9C%AF/">技术</a>
                            
                    </span>
            </div>
            <div class="post-meta-other">
                <i class="far fa-calendar-alt fa-fw"></i><time datetime=2019-11-22>2019-11-22</time>&nbsp;
                <i class="fas fa-pencil-alt fa-fw"></i>about 409 words&nbsp;
                <i class="far fa-clock fa-fw"></i>2 min&nbsp;</div>
        </div>

        
            <div class="post-featured-image">
                <img src=/images/loading.svg data-sizes=auto data-src=https://i.loli.net/2019/11/22/qgB3MXVk1ThExIw.png alt="featured image" class="lazyload">
            </div>
        

        <div class="post-toc" id="post-toc">
                <h2 class="post-toc-title">Table of Contents</h2>
                <div class="post-toc-content">
                    <nav id="TableOfContents">
  <ul>
    <li><a href="#proxy">Proxy：什么是代理？</a></li>
    <li><a href="#heading">正向代理和反向代理</a>
      <ul>
        <li><a href="#forward-proxy">Forward Proxy：正向代理</a></li>
        <li><a href="#reverse-proxy">Reverse Proxy：反向代理</a></li>
      </ul>
    </li>
    <li><a href="#nginx-">Nginx 反向代理的实际应用</a>
      <ul>
        <li><a href="#-upstream-">对 upstream 服务器的定义</a></li>
        <li><a href="#-web-root-">默认 Web Root 的定义</a></li>
        <li><a href="#proxy-">Proxy 转发规则的定义</a></li>
      </ul>
    </li>
    <li><a href="#heading-1">小结</a></li>
  </ul>
</nav>
                </div>
            </div>
            <div class="post-toc-mobile" id="post-toc-mobile">
                <details>
                    <summary><div class="post-toc-title"><span>Table of Contents</span><span><i class="details icon fas fa-angle-down"></i></span></div></summary>
                    <div class="post-toc-content">
                        
                        
                        <nav id="TableOfContentsMobile">
  <ul>
    <li><a href="#proxy">Proxy：什么是代理？</a></li>
    <li><a href="#heading">正向代理和反向代理</a>
      <ul>
        <li><a href="#forward-proxy">Forward Proxy：正向代理</a></li>
        <li><a href="#reverse-proxy">Reverse Proxy：反向代理</a></li>
      </ul>
    </li>
    <li><a href="#nginx-">Nginx 反向代理的实际应用</a>
      <ul>
        <li><a href="#-upstream-">对 upstream 服务器的定义</a></li>
        <li><a href="#-web-root-">默认 Web Root 的定义</a></li>
        <li><a href="#proxy-">Proxy 转发规则的定义</a></li>
      </ul>
    </li>
    <li><a href="#heading-1">小结</a></li>
  </ul>
</nav>
                    </div>
                </details>
            </div>

        <div class="post-content">
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            <p><a href="https://blog.spencerwoo.com/2019/11/tiny-tiny-rss/">Tiny Tiny RSS | 最速部署私有 RSS 服务器</a> 这篇文章里面，我们提到了「利用 Nginx 作为反向代理」来为 Tiny Tiny RSS 服务加上 SSL 支持。事实上，我经常都能在各个和 Nginx、Apache Server 等相关文档里面看到「反向代理」这个术语。今天我们就来看看，到底什么是反向代理？「反向代理」的工作原理，以及我们都可以用「反向代理」来干什么？</p>
<a class="post-dummy-target" id="proxy"></a><h2>Proxy：什么是代理？</h2>
<p>首先，反向代理（Reverse Proxy）是一种代理（Proxy）服务。为了搞清楚「反向代理」，我们首先来说一说「代理 - Proxy」。</p>
<p>相信阅读这篇文章的同学一定对 Proxy 这个名词不陌生，<del>Mainland China 互联网现状让大部分同学的计算机网络知识突飞猛进</del>😂。简单来说，Proxy 服务器的主要功能就是在客户端 Client 和服务端 Server 之间搭建一个桥梁，从客户端访问服务端的网络流量、以及从服务端返回客户端的网络流量都会经由这一 Proxy 服务器的转发。<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup></p>
<p><img src="https://i.loli.net/2019/11/23/SX6GjARx5eKpfEI.png" alt="功能示意"></p>
<p>为了方便表述，我们就叫我们的 Proxy 服务器：咕咕，一只鸽子。🐦</p>
<a class="post-dummy-target" id="heading"></a><h2>正向代理和反向代理</h2>
<a class="post-dummy-target" id="forward-proxy"></a><h3>Forward Proxy：正向代理</h3>
<p>飞鸽传书嘛，信鸽主要功能就是通风报信，我们这里的咕咕也不例外。咕咕在正常情况下是我们自己（客户端）的，也就意味着：咕咕会在 Client 前面等待送信。当 Client 准备发送一个请求的时候，咕咕会拿着这个请求，在公共互联网上面，将请求准确送达至对应的 Server。同理，Server 返回 response 给 Client，response 也会先被咕咕拿到，之后再转交给 Client。</p>
<p><img src="https://i.loli.net/2019/11/23/agNBpxLzSoIAFhi.png" alt="Forward Proxy 的工作原理"></p>
<p>上面就是「正向代理」的基本工作流程，咕咕就是我们这个例子里面的正向代理服务器，负责转发和接受从 Client 发出或收到的网络请求。我们用正向代理（Forward Proxy），<del>除了大家人尽皆知的目的以外</del>😂，还可以：</p>
<ul>
<li>有效屏蔽广告、追踪脚本等有害请求。咕咕可以选择性的将 Server 发来的内容进行屏蔽，也就是：咕咕知道这次发来的是个广告，不给我们看也无妨大碍，那为了让我们浏览体验更加纯净，咕咕就非常体贴的丢掉了这一广告。爱了 ❤️ <sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup></li>
<li>有效的隐藏我们的身份。因为咕咕在你没有用到它的时候，可以并行的为其他同学传递请求。这时候，Server 是无从知道请求的真正来源的，只知道是由咕咕转手的，从而保证我们身份匿名性。</li>
</ul>
<a class="post-dummy-target" id="reverse-proxy"></a><h3>Reverse Proxy：反向代理</h3>
<p>那么反向代理是怎样工作的呢？在反向代理中，我们的咕咕现在由服务器 Server 养活（部署），也就是说，咕咕在服务器端通风报信。每个从 Client 经由互联网发过来的请求会先到达咕咕这里，咕咕再将每个请求分发给相应的服务器。反之亦然。这就是「反向代理」的基本工作原理，我们在这个例子里面的「咕咕」，就是我们的反向代理服务器。（Reverse Proxy Server）</p>
<p><img src="https://i.loli.net/2019/11/23/hUC5TGactx16AJM.png" alt="Reverse Proxy 的工作原理"></p>
<p>为什么我们服务端也需要一个这样的咕咕呢？因为我们的咕咕不仅勤劳，还很坚强。要知道，不是所有的目标服务器都像我们咕咕那么坚强，目标服务器很多时候会因为直接收到的信件过多（收到过多的请求）而被淹没，甚至宕机。如果有咕咕的帮助，目标服务器就不会因为请求过多而无法处理，同时如果咕咕发现一个服务的请求太多，我们可以将这一服务增加多个服务器共同处理，咕咕这时候就可以将服务的请求进行分流，从而减轻单个服务器的处理负担。<strong>这也就是「反向代理」在「负载均衡」方面的应用。</strong></p>
<p>事实上，反向代理服务器有更多的应用，我们接下来就具体说一说我在服务器上面都利用 Nginx 反向代理服务器做了哪些有用的事情。</p>
<a class="post-dummy-target" id="nginx-"></a><h2>Nginx 反向代理的实际应用</h2>
<p>在我的（<a href="https://blog.tenkeyseven.com">@TenkeySeven</a> 的）服务器上面，有这样的几个服务：</p>
<ul>
<li><a href="https://tt-rss.org/">Tiny Tiny RSS 服务</a></li>
<li><a href="https://github.com/netdata/netdata">Netdata 服务器监控服务</a></li>
<li>Nginx 直接 serve 的一个默认静态页面</li>
</ul>
<p>事实上，这三个服务都运行在这样的一个服务器上面，但是绑定了不同的域名。比如：</p>
<ul>
<li>Tiny Tiny RSS 服务对应域名：<a href="https://ttrss.tenkeyseven.com">https://ttrss.tenkeyseven.com</a>（需要登录）</li>
<li>Netdata 服务对应域名：<a href="https://stats.tenkeyseven.com">https://stats.tenkeyseven.com</a>（可以公开访问）</li>
<li>Nginx 测试静态页面对应域名：<a href="https://tenkeyseven.com">https://tenkeyseven.com</a>（可以公开访问）</li>
</ul>
<p>我们连接到服务器上面，执行下面的命令来查看端口占用情况：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">sudo netstat -tulpn <span class="p">|</span> grep LISTEN
</code></pre></td></tr></table>
</div>
</div><p><img src="https://i.loli.net/2019/11/23/XrHv2C5xA8liF3Z.png" alt="端口占用情况"></p>
<p>通过查看端口占用情况，我们可以非常清晰的看到：</p>
<ul>
<li>Tiny Tiny RSS 运行于 Docker 容器中，对外的 exposed 端口是 181</li>
<li>Netdata 前端服务直接监听的端口是 19999</li>
<li>Nginx 默认 serve 的静态页面直接监听 80 端口（HTTP）</li>
</ul>
<p><a href="https://blog.tenkeyseven.com">@TenkeySeven</a> 将主域名和上面提到的两个子域名的 DNS 解析均设置为我们的服务器，因此，当我们访问上面任意一个域名的时候，请求均直接发给服务器上面运行的 Nginx 反向代理服务。</p>
<p>对 Nginx 来说，只需要识别这些域名对应的请求应该转发给具体哪个服务，就可以让请求被正确处理，这样也就实现了我们多个域名对应一个服务器上的多个服务的需求。</p>
<p>Nginx 全部功能均由配置文件 <code>nginx.conf</code> 来设置，这一配置文件通常位于 <code>/etc/nginx/nginx.conf</code>，我们仔细看一下 Nginx 的配置文件。</p>
<a class="post-dummy-target" id="-upstream-"></a><h3>对 upstream 服务器的定义</h3>
<p><img src="https://i.loli.net/2019/11/23/X4Dzh9fBL8NeRGa.png" alt="对 upstream 服务器的声明"></p>
<p>首先，我们在 Nginx 的 <code>http</code> 项目下，定义了我们可能需要用到的 upstream 服务器。比如，对 Tiny Tiny RSS 来说，就是 181 端口的服务，用下面的语法进行声明：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-nginx" data-lang="nginx"><span class="k">upstream</span> <span class="s">ttrssdev</span> <span class="p">{</span>
    <span class="kn">server</span> <span class="n">127.0.0.1</span><span class="p">:</span><span class="mi">181</span><span class="p">;</span>
    <span class="kn">keepalive</span> <span class="mi">64</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>这样，下面 <code>ttrss.tenkeyseven.com</code> 域名的 Proxy 转发规则就可以直接用 <code>http://ttrssdev</code> 的格式进行声明了。</p>
<a class="post-dummy-target" id="-web-root-"></a><h3>默认 Web Root 的定义</h3>
<p><img src="https://i.loli.net/2019/11/23/6jpCBPVJNc9SQIY.png" alt="默认访问 Web Root 的配置"></p>
<p>可以发现，当我们服务并不绑定任何上游服务器，而是直接由 Nginx 来提供服务的时候，Nginx 可以直接 serve 一个目标路径里面的 HTML 文件，比如这里的 <code>/usr/share/nginx/html</code>。此时，直接访问默认主域名 <code>tenkeyseven.com</code>，我们就能直接看到一个默认的静态网页。具体来说，Nginx 就是下面这部分内容的配置，知道当请求匹配到 <code>server_name</code> 定义的域名时，serve <code>root</code> 处定义的 HTML 静态网站。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-nginx" data-lang="nginx"><span class="k">server</span> <span class="p">{</span>
   <span class="kn">server_name</span> <span class="s">tenkeyseven.com</span><span class="p">;</span> <span class="c1"># managed by Certbot
</span><span class="c1"></span>       <span class="kn">root</span>         <span class="s">/usr/share/nginx/html</span><span class="p">;</span>
       <span class="c1"># ...
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><a class="post-dummy-target" id="proxy-"></a><h3>Proxy 转发规则的定义</h3>
<p><img src="https://i.loli.net/2019/11/23/yYojgkwLaAUfGM4.png" alt="反向代理 Tiny Tiny RSS 转发规则的定义"></p>
<p>当我们需要让 Nginx 反向代理转发我们的请求至 upstream 服务的时候，就是类似这样的配置。此时，当请求匹配到 <code>server_name</code> 定义的 <code>ttrss.tenkeyseven.com</code> 时，Nginx 不 serve <code>root</code> 处定义的页面，而是在 <code>location / { ... }</code> 处找到 <code>proxy_pass</code> 的定义，将请求对应的转发到目标服务那里。可以看到，这里我们直接声明了 <code>proxy_pass http://ttrssdev;</code>，于是，当我们访问 <code>https://ttrss.tenkeyseven.com</code> 的时候，Nginx 反向代理服务会直接将请求转发至我们部署的 Tiny Tiny RSS 服务，在服务器上就是 <code>localhost:181</code> 的服务。</p>
<p>Nginx 反向代理具体的配置如下 <code>location / { ... }</code> 里面的配置：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-nginx" data-lang="nginx"><span class="k">server</span> <span class="p">{</span>
   <span class="kn">server_name</span> <span class="s">ttrss.tenkeyseven.com</span><span class="p">;</span> <span class="c1"># managed by Certbot
</span><span class="c1"></span>       <span class="c1"># root         /usr/share/nginx/html;
</span><span class="c1"></span>
       <span class="c1"># Load configuration files for the default server block.
</span><span class="c1"></span>       <span class="kn">include</span> <span class="s">/etc/nginx/default.d/*.conf</span><span class="p">;</span>

       <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>
           <span class="kn">proxy_redirect</span> <span class="no">off</span><span class="p">;</span>
           <span class="kn">proxy_pass</span> <span class="s">http://ttrssdev</span><span class="p">;</span>

           <span class="kn">proxy_set_header</span>  <span class="s">Host</span>                <span class="nv">$http_host</span><span class="p">;</span>
           <span class="kn">proxy_set_header</span>  <span class="s">X-Real-IP</span>           <span class="nv">$remote_addr</span><span class="p">;</span>
           <span class="kn">proxy_set_header</span>  <span class="s">X-Forwarded-Ssl</span>     <span class="no">on</span><span class="p">;</span>
           <span class="kn">proxy_set_header</span>  <span class="s">X-Forwarded-For</span>     <span class="nv">$proxy_add_x_forwarded_for</span><span class="p">;</span>
           <span class="kn">proxy_set_header</span>  <span class="s">X-Forwarded-Proto</span>   <span class="nv">$scheme</span><span class="p">;</span>
           <span class="kn">proxy_set_header</span>  <span class="s">X-Frame-Options</span>     <span class="s">SAMEORIGIN</span><span class="p">;</span>

           <span class="kn">client_max_body_size</span>        <span class="mi">100m</span><span class="p">;</span>
           <span class="kn">client_body_buffer_size</span>     <span class="mi">128k</span><span class="p">;</span>

           <span class="kn">proxy_buffer_size</span>           <span class="mi">4k</span><span class="p">;</span>
           <span class="kn">proxy_buffers</span>               <span class="mi">4</span> <span class="mi">32k</span><span class="p">;</span>
           <span class="kn">proxy_busy_buffers_size</span>     <span class="mi">64k</span><span class="p">;</span>
           <span class="kn">proxy_temp_file_write_size</span>  <span class="mi">64k</span><span class="p">;</span>
       <span class="p">}</span>
    
    <span class="c1"># ...
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>事实上，这部分的配置非常简单。得益于 Let's Encrypt 的存在，我们可以利用 Certbot 在签署每个域名的 SSL 证书时，自动生成对应服务的转发配置。因此，事实上我们只需要声明前面介绍的 upstream 服务，并在 Certbot 生成的对应域名下的 location 子项处将服务器对应到反向代理的配置项处即可。</p>
<a class="post-dummy-target" id="heading-1"></a><h2>小结</h2>
<p>最后，我们可以看到，经过这样的配置，我们从外界互联网访问我们服务器的请求，就被 Nginx 反向代理分别导向了对应的服务器，从而实现了多个域名对应多个服务，并部署在同一个服务器上面的功能。同时，Nginx 反向代理服务统一帮我们管理了 SSL 证书的签署，因此无论是从外界来访问我们服务器的请求，还是我们服务器里面某个服务返回给外界的请求，都是经过加密的 HTTPS 请求。</p>
<p><img src="https://i.loli.net/2019/11/23/2zKHFZmQXShLRAC.png" alt="Nginx 反向代理在上文中的功能"></p>
<p>Nginx 反向代理服务器还有更多的功能，比如：</p>
<ul>
<li>前文提到的负载均衡（Load balance）</li>
<li>用反向代理来作为 CDN，cache 一部分资源，加快访问速度</li>
<li>在请求到达目标服务器之前，反向代理服务器事先过滤掉一部分恶意请求，保证提供服务的目标服务器的稳定工作</li>
<li>……</li>
</ul>
<p>抛砖引玉，感谢阅读。</p>
<section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li><a class="post-dummy-target" id="fn:1" role="doc-endnote"></a>
<p><a href="https://www.cloudflare.com/learning/cdn/glossary/reverse-proxy/">What Is A Reverse Proxy? | Proxy Servers Explained - Cloudflare</a> <a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li><a class="post-dummy-target" id="fn:2" role="doc-endnote"></a>
<p><a href="https://www.youtube.com/watch?v=KBXTnrD_Zs4">Block EVERY Online Ad with THIS / Linus Tech Tips</a> <a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</section>

        </div>

        <div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>This article is updated with 2019-11-22</span>
            </div>
            <div class="post-info-license">
                
            </div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md">
                
                    
                        <span><a class="link-to-markdown" href="https://blog.spencerwoo.com/2019/11/reverse-proxy/index.md" target="_blank"></a></span>
                    
                
            </div>
            <div class="post-info-share">
                
                    <span>
    
        <a href="//twitter.com/share?url=https%3a%2f%2fblog.spencerwoo.com%2f2019%2f11%2freverse-proxy%2f&amp;text=Reverse%20Proxy%20%7c%20%e5%8f%8d%e5%90%91%e4%bb%a3%e7%90%86%e6%98%af%e4%bb%80%e4%b9%88%ef%bc%9f&amp;via=xxxx" target="_blank" title="Share on Twitter">
            <i class="fab fa-twitter fa-fw"></i>
        </a>
    
    
        <a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.spencerwoo.com%2f2019%2f11%2freverse-proxy%2f" target="_blank" title="Share on Facebook">
            <i class="fab fa-facebook-square fa-fw"></i>
        </a>
    
    
        <a href="//reddit.com/submit?url=https%3a%2f%2fblog.spencerwoo.com%2f2019%2f11%2freverse-proxy%2f&amp;title=Reverse%20Proxy%20%7c%20%e5%8f%8d%e5%90%91%e4%bb%a3%e7%90%86%e6%98%af%e4%bb%80%e4%b9%88%ef%bc%9f" target="_blank" title="Share on Reddit">
            <i class="fab fa-reddit fa-fw"></i>
        </a>
    
    
    
    
    
    
    
    
</span>
                
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section>
            
                
                    <span class="tag">
                        <a href="https://blog.spencerwoo.com/tags/tech/"><i class="fas fa-tag fa-fw"></i>Tech</a>
                    </span>
                
                    <span class="tag">
                        <a href="https://blog.spencerwoo.com/tags/server/"><i class="fas fa-tag fa-fw"></i>Server</a>
                    </span>
                
            
        </section>
        <section>
            <span><a href="javascript:window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="https://blog.spencerwoo.com">Home</a></span>
        </section>
    </div>

    <div class="post-nav">
        
            <a href="https://blog.spencerwoo.com/2019/11/tiny-tiny-rss/" class="prev" rel="prev" title="Tiny Tiny RSS | 最速部署私有 RSS 服务器"><i class="fas fa-angle-left fa-fw"></i>Tiny Tiny RSS | 最速部署私有 RSS 服务器</a>
        
        
            <a href="https://blog.spencerwoo.com/2019/11/weibo-to-twitter/" class="next" rel="next" title="IFTTT x Integromat：微博 to Twitter 自动转发的最佳实践">IFTTT x Integromat：微博 to Twitter 自动转发的最佳实践<i class="fas fa-angle-right fa-fw"></i></a>
        
    </div>
</div>

        <div class="post-comment">
            
            

            
        </div>
    </article></div>
            </main>
            <footer class="footer">
    <div class="copyright">
        <div class="copyright-line">
            
            </i> Runs on 🚀 <a href="https://gohugo.io/" target="_blank" rel="external nofollow noopener noreffer">Hugo</a> and ❤️ love
        </div>
        <div class="copyright-line">
            <i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2019</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://blog.spencerwoo.com">Jack Wang</a></span><span class="license">&nbsp;|&nbsp;<a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
    </div>
</footer>



    
    




    
    




    
    





    
    



    
    



    
    





    
    





    
    



    
    





    
    




    
    




    
    



    
    





    
    


<script src="/js/lib/jquery/jquery.slim.min.min.js"></script>
<script src="/js/lib/lazysizes/lazysizes.min.min.js"></script>
<script src="/js/lib/smooth-scroll/smooth-scroll.polyfills.min.min.js"></script><script>window.scroll = new SmoothScroll('[data-scroll]', {speed: 300, speedAsDuration: true});</script>


    
    

    

    

    

    






<script src="/js/blog.min.js"></script>


    
</div>
        <a href="#" class="dynamic-to-top" id="dynamic-to-top" data-scroll><span>&nbsp;</span></a>
    </body>
</html>